using Nethereum.ABI.FunctionEncoding.Attributes;
using Nethereum.Contracts;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using Nethereum.Web3.Accounts;
using Nethereum.Web3;



using Nethereum.Contracts.CQS;
using Nethereum.Util;
using Nethereum.Hex.HexConvertors.Extensions;

using Nethereum.Contracts.Extensions;
using System.Numerics;
using System.Security.Cryptography.X509Certificates;


using Nethereum.Hex.HexTypes;

using Microsoft.Win32;
using System.IO;
using System.Runtime.CompilerServices;
using Org.BouncyCastle.Utilities;
using Org.BouncyCastle.Asn1;

namespace BlockChain_Project
{
 
 
    public class IotCreationContract : ContractDeploymentMessage
    {


        public static string BYTECODE = "60806040523480156200001157600080fd5b506040516200141f3803806200141f833981810160405260a08110156200003757600080fd5b8101908080519060200190929190805160405193929190846401000000008211156200006257600080fd5b838201915060208201858111156200007957600080fd5b82518660018202830111640100000000821117156200009757600080fd5b8083526020830192505050908051906020019080838360005b83811015620000cd578082015181840152602081019050620000b0565b50505050905090810190601f168015620000fb5780820380516001836020036101000a031916815260200191505b50604052602001805160405193929190846401000000008211156200011f57600080fd5b838201915060208201858111156200013657600080fd5b82518660018202830111640100000000821117156200015457600080fd5b8083526020830192505050908051906020019080838360005b838110156200018a5780820151818401526020810190506200016d565b50505050905090810190601f168015620001b85780820380516001836020036101000a031916815260200191505b5060405260200180516040519392919084640100000000821115620001dc57600080fd5b83820191506020820185811115620001f357600080fd5b82518660018202830111640100000000821117156200021157600080fd5b8083526020830192505050908051906020019080838360005b83811015620002475780820151818401526020810190506200022a565b50505050905090810190601f168015620002755780820380516001836020036101000a031916815260200191505b50604052602001805160405193929190846401000000008211156200029957600080fd5b83820191506020820185811115620002b057600080fd5b8251866001820283011164010000000082111715620002ce57600080fd5b8083526020830192505050908051906020019080838360005b8381101562000304578082015181840152602081019050620002e7565b50505050905090810190601f168015620003325780820380516001836020036101000a031916815260200191505b50604052505050846000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550836001908051906020019062000391929190620004cd565b508260029080519060200190620003aa929190620004cd565b506003829080600181540180825580915050906001820390600052602060002001600090919290919091509080519060200190620003ea929190620004cd565b5050806004908051906020019062000404929190620004cd565b507fd9198c92b532669f7e30cc10cc3836efff5eeead14ecd0f1f8f39898c0d912fb6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660405180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828103825260178152602001807f44657669636520686173206265656e20637265617465640000000000000000008152506020019250505060405180910390a150505050506200057c565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200051057805160ff191683800117855562000541565b8280016001018555821562000541579182015b828111156200054057825182559160200191906001019062000523565b5b50905062000550919062000554565b5090565b6200057991905b80821115620005755760008160009055506001016200055b565b5090565b90565b610e93806200058c6000396000f3fe608060405234801561001057600080fd5b50600436106100cf5760003560e01c80637f7650eb1161008c578063d3a417a211610066578063d3a417a21461056d578063dd8d03b3146105c5578063dfaf0221146105e3578063e720b02914610666576100cf565b80637f7650eb146103f95780638da5cb5b1461047c578063b8023fa7146104c6576100cf565b80630c4f65bd146100d45780631a0925411461011e5780632a0daeea146101a15780632d79838a146102245780633c004bd1146102a75780637284e41614610376575b600080fd5b6100dc610735565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61012661075e565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561016657808201518184015260208101905061014b565b50505050905090810190601f1680156101935780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101a9610800565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156101e95780820151818401526020810190506101ce565b50505050905090810190601f1680156102165780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61022c61089e565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561026c578082015181840152602081019050610251565b50505050905090810190601f1680156102995780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610360600480360360208110156102bd57600080fd5b81019080803590602001906401000000008111156102da57600080fd5b8201836020820111156102ec57600080fd5b8035906020019184600183028401116401000000008311171561030e57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610940565b6040518082815260200191505060405180910390f35b61037e610962565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156103be5780820151818401526020810190506103a3565b50505050905090810190601f1680156103eb5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610401610a00565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610441578082015181840152602081019050610426565b50505050905090810190601f16801561046e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610484610a9e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6104f2600480360360208110156104dc57600080fd5b8101908080359060200190929190505050610ac3565b6040518080602001828103825283818151815260200191508051906020019080838360005b83811015610532578082015181840152602081019050610517565b50505050905090810190601f16801561055f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6105af6004803603602081101561058357600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610b7c565b6040518082815260200191505060405180910390f35b6105cd610bc7565b6040518082815260200191505060405180910390f35b6105eb610ccd565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561062b578082015181840152602081019050610610565b50505050905090810190601f1680156106585780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b61071f6004803603602081101561067c57600080fd5b810190808035906020019064010000000081111561069957600080fd5b8201836020820111156106ab57600080fd5b803590602001918460018302840111640100000000831117156106cd57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610d6f565b6040518082815260200191505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b606060028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107f65780601f106107cb576101008083540402835291602001916107f6565b820191906000526020600020905b8154815290600101906020018083116107d957829003601f168201915b5050505050905090565b60048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108965780601f1061086b57610100808354040283529160200191610896565b820191906000526020600020905b81548152906001019060200180831161087957829003601f168201915b505050505081565b606060048054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156109365780601f1061090b57610100808354040283529160200191610936565b820191906000526020600020905b81548152906001019060200180831161091957829003601f168201915b5050505050905090565b60008160019080519060200190610958929190610db9565b5060019050919050565b60028054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156109f85780601f106109cd576101008083540402835291602001916109f8565b820191906000526020600020905b8154815290600101906020018083116109db57829003601f168201915b505050505081565b60018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610a965780601f10610a6b57610100808354040283529160200191610a96565b820191906000526020600020905b815481529060010190602001808311610a7957829003601f168201915b505050505081565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60038181548110610ad057fe5b906000526020600020016000915090508054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b745780601f10610b4957610100808354040283529160200191610b74565b820191906000526020600020905b815481529060010190602001808311610b5757829003601f168201915b505050505081565b6000816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060019050919050565b6000806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fd9198c92b532669f7e30cc10cc3836efff5eeead14ecd0f1f8f39898c0d912fb6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660405180806020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281038252601e8152602001807f44657669636520686173206265656e206465636f6d6d697373696f6e656400008152506020019250505060405180910390a16001905090565b606060018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610d655780601f10610d3a57610100808354040283529160200191610d65565b820191906000526020600020905b815481529060010190602001808311610d4857829003601f168201915b5050505050905090565b60006003829080600181540180825580915050906001820390600052602060002001600090919290919091509080519060200190610dae929190610db9565b505060019050919050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610dfa57805160ff1916838001178555610e28565b82800160010185558215610e28579182015b82811115610e27578251825591602001919060010190610e0c565b5b509050610e359190610e39565b5090565b610e5b91905b80821115610e57576000816000905550600101610e3f565b5090565b9056fea265627a7a7231582014c8d6dacc90bbe618bd8acddcfc3c4a825a5615953aab79a11b673cfa8d1fb964736f6c63430005110032";



        public IotCreationContract() : base(BYTECODE) { }


        [Parameter("address", "_owner", 1)]
        public string _owner { get; set; }

        [Parameter("string", "_productName", 2)]
        public string _ProductName { get; set; }
        [Parameter("string", "_description", 3)]
        public string _Description { get; set; }
        [Parameter("string", "_specification", 4)]
        public string _Specification { get; set; }
        [Parameter("string", "_serialNumber", 5)]
        public string _SerialNumber { get; set; }


    }
    [Function("getOwnerAddress", "address")]
    public class OwnerAddress : FunctionMessage
    {


    }
    [Function("productNameUpdate256", "int256")]
    public class ProductUpdate : FunctionMessage
    {
        [Parameter("string", "newProductName", 1)]
        public string ProductName { get; set; }

    }
    [Function("specificationUpdate", "int256")]
    public class SpecificationUpdate : FunctionMessage
    {
        [Parameter("string", "newSpecification", 1)]
        public string Specification { get; set; }

    }
    [Function("deviceDecommissioning", "int256")]
    public class Decommission : FunctionMessage
    {

    }

    [Function("ownershipTransfer", "int256")]
    public class TransferOwnerShips : FunctionMessage
    {

        [Parameter("address", "newOwner", 1)]
        public string newOwner { get; set; }

    }
    [Function("getProductName", "string")]
    public class ProductName : FunctionMessage
    {


    }
    [Function("getDescription", "string")]
    public class Description : FunctionMessage
    {


    }
    [Function("getSerialNumber", "string")]
    public class SerialNumber : FunctionMessage
    {


    }
    public partial class Form5 : Form
    {
        public string contractaddress1;
        public Form5()
        {
            contractaddress1 = "";
            InitializeComponent();
        }

        private async Task getContract(string eth_address,string privateKey,string productName,string description,string pserialNumber,string specification)
        {
            var url = "http://127.0.0.1:7545";
            var account = new Account(privateKey);
            var web31 = new Web3(account, url);

            var iotcreation = new IotCreationContract
            {
                _owner = eth_address,
                _ProductName = productName,
                _Description = description,
                _SerialNumber = pserialNumber,
                _Specification = specification
            };
            var deploymentHandler = web31.Eth.GetContractDeploymentHandler<IotCreationContract>();
            var transactionReceipt = await deploymentHandler.SendRequestAndWaitForReceiptAsync(iotcreation);
            string contractAddress = transactionReceipt.ContractAddress;
            MessageBox.Show( "Deployed Contract:"+" "+contractAddress);
            var csv = new StringBuilder();

            //in your loop
            string Item1 = contractAddress;
            string Item2= eth_address;
            //Suggestion made by KyleMit
            var newLine = string.Format("{0},{1}", Item1, Item2);
            csv.AppendLine(newLine);

            //after your loop
            
            File.AppendAllText(@"C:\Users\C.z\source\repos\BlockChain Project\BlockChain Project\ContractOwner.txt",csv.ToString());

            MessageBox.Show("JHWGF");
        }
        private void label2_Click(object sender, EventArgs e)
        {
            
            

        }

        private void button1_Click(object sender, EventArgs e)
        {
            string productName = textBox1.Text;
            string description = textBox2.Text;
            string specification = textBox3.Text;
            string pserialNumber = textBox4.Text;
            string eth_address1 = "0x594559a12AF7CC1085f65c53f4252535Bad12203";

            var privateKey1 = "db9820f8b4585f5f022b03e062431636dc965aff525b195cee787c1fe55fd02b";
            


            getContract(eth_address1, privateKey1, productName, description, specification, pserialNumber);
            
            
            Form2 S = new Form2();
            S.Show();
        }
    }
}
